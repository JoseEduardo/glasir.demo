<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
  <changeSet id="00439.abandoned_order_views.sql.xml" author="glasir" context="all">
    <preConditions>
      <not>
        <tableExists tableName="bogus_precondition_table_name" />
      </not>
    </preConditions>
    <sql><![CDATA[


--  @version $Id: //product/DCS/version/10.1.1/templates/DCS/AbandonedOrderServices/sql/abandoned_order_views.xml#1 $$Change: 690623 $
create or replace view drpt_abandon_ord
as
      select oa.abandonment_date as abandonment_date, ai.amount as amount, decode(oa.abandon_state, 'CONVERTED', 100, 0) as converted from dcspp_order o, dcspp_ord_abandon oa, dcspp_amount_info ai where oa.order_id=o.order_id and o.price_info=ai.amount_info_id;

create or replace view drpt_tns_abndn_ord
as
      select date_time as abandonment_date, amount as amount from drpt_session_ord where submitted=0;
]]>
  </sql>
    <rollback />
  </changeSet>
</databaseChangeLog>