buildscript {    
  repositories {
    maven {
      credentials.username artifactoryReader
      credentials.password artifactoryReaderPwd
      url "$artifactoryReaderUrl/glasir"
    }
  }
  
  configurations.classpath {
    resolutionStrategy {
      //failOnVersionConflict()
      cacheDynamicVersionsFor 0, 'minutes'
      cacheChangingModulesFor 0, 'minutes'
    }
  }

  dependencies {
    classpath('com.iteego.glasir:glasir.build:1.1.5-SNAPSHOT') { changing=true }
    classpath('org.jfrog.buildinfo:build-info-extractor-gradle:2.0.7')
    classpath('org.codehaus.groovy.modules.http-builder:http-builder:0.5.1') {
      exclude group: 'org.codehaus.groovy', module: 'groovy'
    }
  }
    
  configurations.classpath.each { file -> settings.classLoader.addURL(file.toURI().toURL()) }
}

gradle.allprojects { 
  repositories {
    maven {
      credentials.username artifactoryReader
      credentials.password artifactoryReaderPwd
      url "$artifactoryReaderUrl/glasir"
    }
  }
  
  configurations.all {
    resolutionStrategy {
      //failOnVersionConflict()
      cacheDynamicVersionsFor 60, 'minutes'
      cacheChangingModulesFor 60, 'minutes'
    }
  }


}

new glasir.Build(this).with {
  setup {
    rootProjectName "glasir-app"
    cachePackagesFor 5, 'minutes'
    
    //disablePackageUpdates true
    dependencies {
      glasirpackage('com.iteego.glasir.pkg:atg-10.0.2:1.0')
      glasirpackage('com.iteego.glasir.pkg:jboss-eap-5.1.0:1.0')
      glasirpackage('com.iteego.glasir.pkg:glasir.db:1.0.88-SNAPSHOT') { changing=true }
    }
    
    addAtgModules from: atgRoot
    addAtgModules from: "$settingsDir/packages/modules", isGlasirCore: true
    addAtgModules from: "$settingsDir/glasir-app", isAtgCore: false, 
                  excludes: ["**/j2ee-apps/", "**/data/db/", "**/data/import", "**/build/", "**/config/", "**/src/", "**/lib/"]
  }
}
